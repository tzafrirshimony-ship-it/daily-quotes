<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>העצמה יומית</title>
    
    <!-- PWA Metadata -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="data:application/manifest+json,{'name':'DailyQuotes','short_name':'העצמה','start_url':'.','display':'standalone','background_color':'#ffffff','theme_color':'#4f46e5'}">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Assistant', sans-serif; background: #f9fafb; }
        .btn-active:active { transform: scale(0.98); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

    <div class="w-full max-w-sm bg-white rounded-[2rem] shadow-2xl p-8 text-center border border-gray-50">
        <header class="mb-8">
            <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
            </div>
            <h1 class="text-2xl font-extrabold text-gray-800">העצמה יומית</h1>
            <p class="text-gray-400 text-xs mt-1">אנא בצע "הוספה למסך הבית"</p>
        </header>

        <div class="space-y-4">
            <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                <span class="block text-[10px] font-bold text-gray-400 uppercase mb-1">שעת התראה</span>
                <input type="time" id="userTime" class="w-full bg-transparent text-2xl font-bold text-center text-indigo-600 outline-none">
            </div>

            <button onclick="setupApp()" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold btn-active shadow-lg shadow-indigo-100">
                הפעל התראות
            </button>
            
            <button onclick="sendTest()" class="w-full text-indigo-500 text-xs font-bold underline">
                שלח התראת בדיקה עכשיו
            </button>
        </div>

        <div id="debug" class="mt-6 text-[10px] text-red-500 font-bold hidden"></div>
    </div>

    <script>
        const quotes = [
            "הדרך היחידה לעשות עבודה נהדרת היא לאהוב את מה שאתה עושה.",
            "העתיד שייך לאלו המאמינים ביופי של החלומות שלהם.",
            "כל יום הוא הזדמנות שנייה.",
            "תאמין שאתה יכול ואתה כבר בחצי הדרך."
        ];

        // טעינת שעה
        document.getElementById('userTime').value = localStorage.getItem('savedTime') || '08:00';

        async function setupApp() {
            const time = document.getElementById('userTime').value;
            localStorage.setItem('savedTime', time);
            
            // 1. בקשת הרשאה
            const permission = await Notification.requestPermission();
            if (permission !== 'granted') {
                showError("חובה לאשר התראות בהגדרות הדפדפן");
                return;
            }

            // 2. רישום Service Worker (הקוד שרץ ברקע)
            if ('serviceWorker' in navigator) {
                const swCode = `
                    self.addEventListener('install', e => self.skipWaiting());
                    self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                await navigator.serviceWorker.register(URL.createObjectURL(blob));
            }

            alert("המערכת הופעלה! וודא שהאפליקציה במסך הבית");
        }

        function sendNotification(title, msg) {
            if (Notification.permission === 'granted') {
                navigator.serviceWorker.ready.then(reg => {
                    reg.showNotification(title, {
                        body: msg,
                        icon: 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png',
                        vibrate: [200, 100, 200]
                    });
                });
            }
        }

        function sendTest() {
            if (Notification.permission !== 'granted') {
                alert("קודם לחץ על הכפתור הכחול ואשר התראות");
                return;
            }
            sendNotification("בדיקה!", "אם ראית את זה, ההתראות עובדות.");
        }

        function checkTime() {
            const now = new Date();
            const current = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            const target = localStorage.getItem('savedTime');
            const last = localStorage.getItem('lastDate');

            if (current === target && last !== now.toDateString()) {
                const q = quotes[Math.floor(Math.random() * quotes.length)];
                sendNotification("השראה יומית ✨", q);
                localStorage.setItem('lastDate', now.toDateString());
            }
        }

        function showError(m) {
            const d = document.getElementById('debug');
            d.innerText = m;
            d.classList.remove('hidden');
        }

        // בדיקה כל 30 שניות
        setInterval(checkTime, 30000);
    </script>
</body>
</html>

